
if [ -f /etc/centos-release ]; then
        xccdf='centos7'
else   
        xccdf='rhel7'
fi

if oscap info /usr/share/xml/scap/ssg/content/ssg-${xccdf}-xccdf.xml | grep -q stig-rhel7-disa; then
	xccdf_profile=xccdf_clip_profile_stig-rhel7-disa-server
	tailoring="--tailoring-file /usr/share/clip-miscfiles/scap-tailoring.xml"
	fix_template="--template urn:xccdf:fix:script:sh"
else
	xccdf_profile=stig-rhel7-server-upstream
	tailoring=
	fix_template=
fi

mkdir -p /root/scap/{pre,post}/html
oscap xccdf eval --profile $xccdf_profile \
$tailoring \
--report /root/scap/pre/html/report.html \
--results /root/scap/pre/html/results.xml \
/usr/share/xml/scap/ssg/content/ssg-${xccdf}-xccdf.xml

oscap xccdf generate fix \
$tailoring \
--result-id xccdf_org.open-scap_testresult_$xccdf_profile \
$fix_template \
/root/scap/pre/html/results.xml > /root/scap/pre/remediation-script.sh

chmod +x /root/scap/pre/remediation-script.sh
